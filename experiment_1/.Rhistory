ggplot(data=sum_time_equiv)+
geom_point(aes(x=factor(b_fixed_rw),
y=std_vary_rw,
shape=factor(b_delay),
color=factor(a_rw)))+
geom_line(aes(linetype = interaction(factor(b_delay), factor(a_rw)))) +
facet_wrap(vars(cond))+
theme_bw()
ggplot(data=sum_time_equiv)+
geom_point(aes(x=factor(b_fixed_rw),
y=std_vary_rw,
group= interaction(factor(b_delay),factor(a_rw))),
color= interaction(factor(b_delay),factor(a_rw))))+
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw,
group= interaction(factor(b_delay),factor(a_rw)),
color= interaction(factor(b_delay),factor(a_rw))))+
geom_point()+
geom_line(aes(linetype = interaction(factor(b_delay), factor(a_rw)))) +
facet_wrap(vars(cond))+
theme_bw()
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw,
shape= interaction(factor(b_delay),factor(a_rw)),
color= interaction(factor(b_delay),factor(a_rw))))+
geom_point()+
geom_line(aes(linetype = interaction(factor(b_delay), factor(a_rw)))) +
facet_wrap(vars(cond))+
theme_bw()
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw))+
geom_point(aes(shape= interaction(factor(b_delay),factor(a_rw)),
color= interaction(factor(b_delay),factor(a_rw))))+
geom_line(aes(linetype = interaction(factor(b_delay), factor(a_rw)))) +
facet_wrap(vars(cond))+
theme_bw()
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw))+
geom_point(aes(group= interaction(factor(b_delay),factor(a_rw)),
color= interaction(factor(b_delay),factor(a_rw))))+
geom_line(aes(linetype = interaction(factor(b_delay), factor(a_rw)))) +
facet_wrap(vars(cond))+
theme_bw()
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw))+
geom_point(aes(shape= interaction(factor(b_delay),factor(a_rw)),
color= interaction(factor(b_delay),factor(a_rw))))+
geom_line(aes(linetype = interaction(factor(b_delay), factor(a_rw)))) +
facet_wrap(vars(cond))+
theme_bw()
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw))+
geom_point(aes(shape= factor(b_delay),
color= factor(a_rw)))+
geom_line(aes(linetype = interaction(factor(b_delay), factor(a_rw)))) +
facet_wrap(vars(cond))+
theme_bw()
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw))+
geom_point(aes(shape= factor(b_delay),
color= factor(a_rw)))+
geom_line(aes(linetype = interaction(b_delay, a_rw))) +
facet_wrap(vars(cond))+
theme_bw()
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw))+
geom_point(aes(shape= factor(b_delay),
color= factor(a_rw)))+
geom_line(aes(group = interaction(b_delay, a_rw))) +
facet_wrap(vars(cond))+
theme_bw()
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw))+
geom_point(aes(shape= factor(b_delay),
color= factor(a_rw)))+
geom_line(aes(group = interaction(b_delay, a_rw)),linetype = 'dotdash') +
facet_wrap(vars(cond))+
theme_bw()
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw))+
geom_point(aes(shape= factor(b_delay),
color= factor(a_rw)))+
geom_line(aes(group = interaction(b_delay, a_rw)),linetype = 'dashed') +
facet_wrap(vars(cond))+
theme_bw()
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw))+
geom_point(aes(shape= factor(b_delay),
color= factor(a_rw)))+
geom_line(aes(group = interaction(b_delay, a_rw)),
linetype = 'dashed', color = 'grey') +
facet_wrap(vars(cond))+
theme_bw()
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw))+
geom_point(aes(color= factor(b_delay),
shape= factor(a_rw)))+
geom_line(aes(group = interaction(b_delay, a_rw)),
linetype = 'dashed', color = 'grey') +
facet_wrap(vars(cond))+
theme_bw()
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw))+
geom_point(aes(color= factor(b_delay),
shape= factor(a_rw)),
size = 2)+
geom_line(aes(group = interaction(b_delay, a_rw)),
linetype = 'dashed', color = 'grey') +
facet_wrap(vars(cond))+
theme_bw()
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw))+
geom_point(aes(shape= factor(b_delay),
color= factor(a_rw)),
size = 2)+
geom_line(aes(group = interaction(b_delay, a_rw)),
linetype = 'dashed', color = 'grey') +
facet_wrap(vars(cond))+
scale_shape_discrete(name = "time length of B (month)") +
scale_color_discrete(name = "reward amount of A (£)") +
theme_bw(12)
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw))+
geom_point(aes(shape= factor(b_delay),
color= factor(a_rw)),
size = 2)+
geom_line(aes(group = interaction(b_delay, a_rw)),
linetype = 'dashed', color = 'grey') +
facet_wrap(vars(cond))+
labs(x = 'reward amount constant across rows in B')
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw))+
geom_point(aes(shape= factor(b_delay),
color= factor(a_rw)),
size = 2)+
geom_line(aes(group = interaction(b_delay, a_rw)),
linetype = 'dashed', color = 'grey') +
facet_wrap(vars(cond))+
labs(x = 'reward amount constant across rows in B',
y = 'standard deviation of switch point') +
scale_shape_discrete(name = "time length of B (month)") +
scale_color_discrete(name = "reward amount of A (£)") +
theme_bw(12)
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw))+
geom_point(aes(shape= factor(b_delay),
color= factor(a_rw)),
size = 2)+
geom_line(aes(group = interaction(b_delay, a_rw)),
linetype = 'dashed', color = 'grey') +
facet_wrap(vars(cond))+
labs(x = 'reward amount constant across rows in B (×£10)',
y = 'standard deviation of switch point') +
scale_shape_discrete(name = "time length of B (month)") +
scale_color_discrete(name = "reward amount of A (×£10)") +
theme_bw(12)
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw))+
geom_point(aes(shape= factor(b_delay),
color= factor(a_rw)),
size = 2)+
geom_line(aes(group = interaction(b_delay, a_rw)),
linetype = 'dashed', color = 'grey') +
facet_wrap(~cond,
labeller = as_labeller(
c('Immed_Rw_Vary' = 'Immediate reward varies',
'Delayed_Rw_Vary' = 'Delayed reward varies')))+
labs(x = 'reward amount constant across rows in B (×£10)',
y = 'standard deviation of switch point') +
scale_shape_discrete(name = "time length of B (month)") +
scale_color_discrete(name = "reward amount of A (×£10)") +
theme_bw(12)
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw))+
geom_point(aes(shape= factor(b_delay),
color= factor(a_rw)),
size = 2)+
geom_line(aes(group = interaction(b_delay, a_rw)),
linetype = 'dashed', color = 'grey') +
facet_wrap(~cond,
labeller = as_labeller(
c('Immed_Rw_Vary' = 'Immediate reward varies',
'Delayed_Rw_Vary' = 'Delayed reward varies')))+
labs(x = 'reward amount constant across rows in B (×£10)',
y = 'standard deviation of switch point') +
scale_shape_discrete(name = "time length of B (month)") +
scale_color_discrete(name = "reward amount of A (×£10)") +
theme_bw(12)+
theme(
legend.position = 'top'
)
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw))+
geom_point(aes(shape= factor(b_delay),
color= factor(a_rw)),
size = 2)+
geom_line(aes(group = interaction(b_delay, a_rw)),
linetype = 'dashed', color = 'grey') +
facet_wrap(~cond,
labeller = as_labeller(
c('Immed_Rw_Vary' = 'Immediate reward varies',
'Delayed_Rw_Vary' = 'Delayed reward varies')))+
labs(x = 'reward amount constant across rows in B (×£10)',
y = 'standard deviation of switch point') +
scale_shape_discrete(name = "time length of B (month)") +
scale_color_discrete(name = "reward amount of A (×£10)") +
theme_bw(12)+
theme(
legend.position = 'top',
legend.key.width = unit(0.3, "cm"),
axis.title.x = element_text(margin = margin(t = 8)),
axis.title.y = element_text(margin = margin(r = 8)),
text = element_text(family = "Times New Roman")
)
ggsave('fig_std_switch.png',device = 'png',width = 18, height = 10, units = 'cm')
ggsave('fig_std_switch.png',device = 'png',width = 12, height = 10, units = 'cm')
ggsave('fig_std_switch.png',device = 'png',width = 16, height = 10, units = 'cm')
ggsave('fig_std_switch.png',device = 'png',width = 18, height = 10, units = 'cm')
ggsave('fig_std_switch.png',device = 'png',width = 17, height = 10, units = 'cm')
ggsave('fig_std_switch.png',device = 'png',width = 17, height = 9, units = 'cm')
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw))+
geom_point(aes(shape= factor(b_delay),
color= factor(a_rw)),
size = 2)+
geom_line(aes(group = interaction(b_delay, a_rw)),
linetype = 'dashed', color = 'grey') +
facet_wrap(~cond,
labeller = as_labeller(
c('Immed_Rw_Vary' = 'Immediate reward varies',
'Delayed_Rw_Vary' = 'Delayed reward varies')))+
labs(x = 'reward amount constant across rows in B (×£10)',
y = 'standard deviation') +
scale_shape_discrete(name = "time length of B (month)") +
scale_color_discrete(name = "reward amount of A (×£10)") +
theme_bw(12)+
theme(
legend.position = 'top',
legend.key.width = unit(0.3, "cm"),
axis.title.x = element_text(margin = margin(t = 8)),
axis.title.y = element_text(margin = margin(r = 8)),
text = element_text(family = "Times New Roman")
)
ggsave('fig_std_switch.png',device = 'png',width = 17, height = 9, units = 'cm')
ggplot(data=sum_time_equiv,
aes(x=factor(b_fixed_rw),
y=std_vary_rw))+
geom_point(aes(shape= factor(b_delay),
color= factor(a_rw)),
size = 2)+
geom_line(aes(group = interaction(b_delay, a_rw)),
linetype = 'dashed', color = 'grey') +
facet_wrap(~cond,
labeller = as_labeller(
c('Immed_Rw_Vary' = 'Immediate reward varies',
'Delayed_Rw_Vary' = 'Delayed reward varies')))+
labs(x = 'reward amount constant across rows in B (×£10)',
y = 'standard deviation') +
scale_shape_discrete(name = "Time length of B (month)") +
scale_color_discrete(name = "Reward amount of A (×£10)") +
theme_bw(12)+
theme(
legend.position = 'top',
legend.key.width = unit(0.3, "cm"),
axis.title.x = element_text(margin = margin(t = 8)),
axis.title.y = element_text(margin = margin(r = 8)),
text = element_text(family = "Times New Roman")
)
ggsave('fig_std_switch.png',device = 'png',width = 17, height = 9, units = 'cm')
ggsave('fig_std_switch.png',device = 'png',width = 18, height = 9, units = 'cm')
library(logistf)
df_choice <- read.csv('intertemporal_choice_obs.csv')[,-1]
df_time_delayed <- df_choice[df_choice$cond == 'Delayed_Rw_Vary',]
# Firth's Bias-Reduced Regression
sample_id <- sample(unique(df_time_delayed$pid),10)
# Firth's Bias-Reduced Regression
sample_id <- sample(unique(df_time_delayed$pid),20)
sample <- df_time_delayed[df_time_delayed$pid %in% sample_id,]
formula2 <- as.formula("choice ~ a_rw + b_vary_rw*factor(b_fixed_rw) + factor(pid)")
firth_reg2 <- logistf(formula2,
data = sample,
family = binomial(link='logit'),
)
firth_reg2 <- logistf(formula2,
data = sample,
family = binomial(link='logit'),
)
firth_reg2
firth_reg2$loglik
firth_reg2$hat.diag
firth_reg2$method.ci
firth_reg2 <- flac(formula2,
data = sample,
family = binomial(link='logit'),
)
firth_reg2 <- flac(formula2,
data = data.frame(sample),
family = binomial(link='logit'),
)
firth_reg2 <- flac(formula2,
data = data.frame(sample),
family = binomial(link='logit'),
)
data.frame(sample)
sample <- data.frame(sample)
firth_reg2 <- flac(formula2,
data = sample,
family = binomial(link='logit'),
)
firth_reg2 <- flac(formula2,
data = sample,
family = binomial(link='logit'),
)
sample <- data.frame(sample)
formula2 <- as.formula("choice ~ a_rw + b_vary_rw*factor(b_fixed_rw) + factor(pid)")
firth_reg2 <- flac(formula2,
data = sample,
family = binomial(link='logit'),
)
firth_reg2 <- flic(formula2,
data = sample,
family = binomial(link='logit'),
)
firth_reg2 <- logistf(formula2,
data = sample,
family = binomial(link='logit'),
)
warnings()
# Firth's Bias-Reduced Regression
sample_id <- sample(unique(df_time_delayed$pid),40)
sample <- df_time_delayed[df_time_delayed$pid %in% sample_id,]
sample <- data.frame(sample)
firth_reg2 <- logistf(formula2,
data = sample,
family = binomial(link='logit'),
)
firth_reg2
firth_reg2 <- logistf.fit(formula2,
data = sample,
family = binomial(link='logit'),
)
firth_reg2 <- flic(formula2,
data = sample,
family = binomial(link='logit'),
)
firth_reg2 <- logistf(formula2,
data = sample,
family = binomial(link='logit'),
flic = TRUE
)
firth_reg2
summary(firth_reg2)
library(tidyverse)
library(ggpubr)
library(tidyverse)
library(ggpubr)
library(gridExtra)
source('reg_analysis.R')
write()
write_reg_tab('./tables/logit1.tex',res_logit1,
var_name = var_name_immed)
write_reg_tab('./tables/logit1.tex',res_logit1,
var_name = var_name_immed)
write_reg_tab('./tables/logit2.tex',res_logit2,
var_name = var_name_delayed)
source('reg_analysis.R')
# ----------------------------------
#       Plot Baseline Results
# ----------------------------------
# Plots: Immed_Rw_Vary
firth_pred_immed <- read.csv('firth_pred_immed.csv')[,-1]
tab_immed <- df_time_immed %>%
group_by(b_vary_rw,a_rw,b_fixed_rw,b_delay) %>%
summarise(mean_choice = mean(choice),
pred_logit = mean(pred_logit),
pred_logit_u = mean(pred_logit_u)
) %>%
left_join(firth_pred_immed) %>%
mutate(b_vary_rw = b_vary_rw*10,
b_fixed_rw = b_fixed_rw*10,
a_rw = a_rw*10)
fig_immed_1 <- ggplot(data = tab_immed[tab_immed$a_rw == unique(tab_immed$a_rw)[1],],
aes(x = b_vary_rw,
y = mean_choice,
color = factor(b_fixed_rw),
shape = factor(b_delay))) +
geom_point(size=2)+
geom_line(aes(y=pred_logit),linetype = 'dashed',alpha=0.75)+
ggtitle(paste0('(1) option A: £',unique(tab_immed$a_rw)[1], ''))+
labs(x = "immediate reward in option B (£)",
y = "probability of choosing B")+
scale_x_continuous(breaks = c(1:10)*10) +
scale_shape_discrete(name = "time length of option B (month)") +
scale_color_discrete(name = "delayed reward in option B (£)") +
theme_bw(12)+
theme(
legend.position = "bottom",
legend.box = "vertical",
legend.spacing.y = unit(-0.2, "cm"),
legend.key.width = unit(0.3, "cm"),
axis.title.x = element_text(margin = margin(t = 8)),
axis.title.y = element_text(margin = margin(r = 8)),
text = element_text(family = "Times New Roman")
)
fig_immed_2 <- ggplot(data = tab_immed[tab_immed$a_rw == unique(tab_immed$a_rw)[2],],
aes(x = b_vary_rw,
y = mean_choice,
color = factor(b_fixed_rw),
shape = factor(b_delay))) +
geom_point(size=2)+
geom_line(aes(y=pred_logit),linetype='dashed',alpha=0.75)+
ggtitle(paste0('(2) option A: £',unique(tab_immed$a_rw)[2], ''))+
labs(x = "immediate reward in option B (£)",
y = "")+
scale_x_continuous(breaks = c(1:10)*10) +
scale_shape_discrete(name = "time length of option B (month)") +
scale_color_discrete(name = "delayed reward in option B (£)") +
theme_bw(12)+
theme(
legend.position = "bottom",
legend.box = "vertical",
legend.spacing.y = unit(-0.2, "cm"),
legend.key.width = unit(0.3, "cm"),
axis.title.x = element_text(margin = margin(t = 8)),
axis.title.y = element_text(margin = margin(r = 8)),
text = element_text(family = "Times New Roman")
)
panel_immed <- ggarrange(fig_immed_1, fig_immed_2,
ncol = 2, common.legend = TRUE, legend="bottom")
# Plots: Delayed_Rw_Vary
firth_pred_delayed <- read.csv('firth_pred_delayed.csv')[,-1]
tab_delayed <- df_time_delayed %>%
group_by(b_vary_rw,a_rw,b_fixed_rw,b_delay) %>%
summarise(mean_choice = mean(choice),
pred_logit = mean(pred_logit),
pred_logit_u = mean(pred_logit_u)) %>%
left_join(firth_pred_delayed) %>%
mutate(b_vary_rw = b_vary_rw*10,
b_fixed_rw = b_fixed_rw*10,
a_rw = a_rw*10)
fig_delayed_1 <- ggplot(data = tab_delayed[tab_delayed$a_rw == unique(tab_delayed$a_rw)[1],],
aes(x = b_vary_rw,
y = mean_choice,
color = factor(b_fixed_rw))) +
geom_point(size=2)+
geom_line(aes(y=pred_logit),linetype='dashed',alpha=0.75)+
ggtitle(paste0('(1) option A: £',unique(tab_delayed$a_rw)[1], ''))+
labs(x = "delayed reward in option B (£)",
y = "probability of choosing B")+
scale_x_continuous(breaks = c(1:10)*10) +
scale_color_discrete(name = "immediate reward in option B (£)") +
theme_bw(12)+
theme(
legend.position = "bottom",
axis.title.x = element_text(margin = margin(t = 8)),
axis.title.y = element_text(margin = margin(r = 8)),
text = element_text(family = "Times New Roman")
)
fig_delayed_2 <- ggplot(data = tab_delayed[tab_delayed$a_rw == unique(tab_delayed$a_rw)[2],],
aes(x = b_vary_rw,
y = mean_choice,
color = factor(b_fixed_rw))) +
geom_point(size=2)+
geom_line(aes(y=pred_logit),linetype='dashed',alpha=0.75)+
ggtitle(paste0('(2) option A: £',unique(tab_delayed$a_rw)[2], ''))+
labs(x = "delayed reward in option B (£)",
y = "")+
scale_x_continuous(breaks = c(1:10)*10) +
scale_color_discrete(name = "immediate reward in option B (£)") +
theme_bw(12)+
theme(
legend.position = "bottom",
axis.title.x = element_text(margin = margin(t = 8)),
axis.title.y = element_text(margin = margin(r = 8)),
text = element_text(family = "Times New Roman")
)
panel_delayed <- ggarrange(fig_delayed_1, fig_delayed_2,
ncol = 2, common.legend = TRUE, legend="bottom")
title_immed <- grid::textGrob("Panel A: Immediate reward varies",
gp = grid::gpar(fontsize=14, fontfamily = "Times New Roman"))
title_delayed <- grid::textGrob("Panel B: Delayed reward varies",
gp = grid::gpar(fontsize=14, fontfamily = "Times New Roman"))
panel_immed_with_title <- arrangeGrob(title_immed, panel_immed,
heights = c(0.2,1))
panel_delayed_with_title <- arrangeGrob(title_delayed, panel_delayed,
heights = c(0.2,1))
fig_grand <- grid.arrange(panel_immed_with_title,
panel_delayed_with_title,
ncol =1,
heights = c(1.15,1))
ggsave('./figures/fig_grand_baseline.png',fig_grand,device = 'png',width = 18, height = 20, units = 'cm')
